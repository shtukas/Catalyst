#!/Users/pascal/.rvm/rubies/ruby-2.5.1/bin/ruby

# encoding: UTF-8

require_relative "InFlightControlSystem.rb"

loop {
    system('clear')
    puts getReportText()
    puts ""
    puts (getReportLine() || "No line report at this moment")
    puts ""
    options = [
        "items dive",
        "apply recommended"
    ]
    option = LucilleCore::selectEntityFromListOfEntitiesOrNull("ifcs", options)
    break if option.nil?
    if option == "items dive" then
        item = LucilleCore::selectEntityFromListOfEntitiesOrNull("item", itemsOrderedByPosition(), lambda{|item| item["description"] })
        next if item.nil?
        loop {
            puts JSON.pretty_generate(item)
            oxs = [ "start", "stop", "suspend temporarily" ]
            ox = LucilleCore::selectEntityFromListOfEntitiesOrNull("ifcs", oxs)
            break if ox.nil?
            if ox == "start" then
                startItem(item["uuid"])
            end
            if ox == "stop" then
                stopItem(item["uuid"])
            end
            if ox == "suspend temporarily" then
                timespanInHours = LucilleCore::askQuestionAnswerAsString("time in hours: ").to_f
                item["DoNotShowUntilUnixtime"] = Time.new.to_i + timespanInHours*3600
                saveItem(item)
            end
        }
    end
    if option == "apply recommended" then
        nextaction = getNextAction()
        nextaction[1].call()
    end
}




