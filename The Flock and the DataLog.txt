
# ----------------------------------------
# Introduction

The "Flock" refers to the collection of all objects in their latest version.

At startup: Events are read from the file system and a view of the system is built. In essence every mutation of the system is represented as an Event. Events are JSON objects

The Flock is sent to the UI subsystem fo display

User actions from the UI are represented as Events.

And event has a primary target that is either Catalyst itself or an Agent referred to by it agent-uid, and a secondary target that is often a an object, referred to by its object uuid.

Before every UI display the events in the buffer are processed.

The processing of each UI event is received by an Operator which sends it either to the Catalyst Processor or to an agent's Processor. In every case the Processor takes the event and the Flock as parameters and emit a new Flock and a sequence of events that need to be written to disk.

Then the Operator sends the entire Flock to each agent to give each agent an opportunity to update the existing objects and emit new Events. 

# -----------------------------------------
Flock:

$flock = {}
$flock["objects"] = []
$flock["do-not-show-until-datetime-distribution"] = {}
$flock["kvstore"] = {}

# -----------------------------------------
# Catalyst Objects:

{
    "uuid"                : String (uuid)
    "agent-uid"           : String (uuid)
    "metric"              : Float
    "announce"            : String
    "commands"            : Array[String]
    "default-expression"  : Null or String
    "item-data"           : () # Agent specific metadata
}


# -----------------------------------------
Events:

nb: each event has a ":filepath:" key that is populated while reading from disk

{
    "event-type" : "Catalyst:Catalyst-Object:1"
    "object"     : (object)
}

{
    "event-type"  : "Catalyst:Destroy-Catalyst-Object:1"
    "object-uuid" : String
}

{
    "event-type"  : "Catalyst:Metadata:DoNotShowUntilDateTime:1"
    "object-uuid" : String
    "datetime"    : datetime (string)
}

{
    "event-type" => "Flock:KeyValueStore:Set:1",
    "key"        => key,
    "value"      => value
}


